generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String           @id @default(cuid())
  email           String           @unique
  password        String
  tasks           Task[]
  completions     TaskCompletion[]
  emergencyUsages EmergencyUsage[]
  settings        Settings?
}

model Task {
  id          String           @id @default(cuid())
  userId      String
  name        String
  isCompleted Boolean          @default(false)
  validated   Boolean          @default(false)
  createdAt   DateTime         @default(now())
  user        User             @relation(fields: [userId], references: [id])
  completions TaskCompletion[]
}

model TaskCompletion {
  id                     String   @id @default(cuid())
  taskId                 String
  userId                 String
  completedAt            DateTime @default(now())
  proofSubmitted         Boolean
  proofUrl               String?
  proofText              String?
  usedEmergencyMode      Boolean  @default(false)
  emergencyJustification String?
  task                   Task     @relation(fields: [taskId], references: [id])
  user                   User     @relation(fields: [userId], references: [id])
}

model EmergencyUsage {
  id     String @id @default(cuid())
  userId String
  week   Int
  year   Int
  user   User   @relation(fields: [userId], references: [id])
}

model Settings {
  id                 String @id @default(cuid())
  userId             String @unique
  emergencyModeLimit Int    @default(3)
  user               User   @relation(fields: [userId], references: [id])
}
